{% extends "layout.html" %}

{% block content %}
<div class="container mt-4 mb-5">
    <div class="d-print-none mb-4 d-flex justify-content-between">
        <a href="/dashboard" class="btn btn-secondary">‚Üê Back to Dashboard</a>
        <button onclick="window.print()" class="btn btn-primary">
            üñ®Ô∏è Download as PDF / Print
        </button>
    </div>

    <div class="card shadow-sm border-0 mx-auto" style="max-width: 850px; background: white;" id="printableArea">
        <div class="card-body p-5">
            
            <div class="row border-bottom pb-4 mb-4">
                <div class="col-6">
                    <h2 class="text-uppercase fw-bold text-primary">Medical Record</h2>
                    <p class="text-muted mb-0">Patient Clinical Summary</p>
                </div>
                <div class="col-6 text-end">
                    <h5 class="fw-bold">EHR Hospital System</h5>
                    <p class="small text-muted">Generated by: Dr. {{ session['username'] }}<br>
                    Date: {{ patient.created_at }}</p>
                </div>
            </div>

            <div class="row mb-4">
                <div class="col-md-3 text-center mb-3">
                    <img src="{{ url_for('static', filename=patient.patient_img) }}" 
     class="img-thumbnail rounded" 
     style="width: 150px; height: 150px; object-fit: cover;"
     alt="Patient Photo">
                </div>
                
                <div class="col-md-9">
                    <div class="row">
                        <div class="col-6 mb-2"><strong>First Name:</strong> {{ patient.first_name }}</div>
                        <div class="col-6 mb-2"><strong>Last Name:</strong> {{ patient.last_name }}</div>
                        <div class="col-6 mb-2"><strong>Insurance ID:</strong> {{ patient.insurance_number }}</div>
                        <div class="col-6 mb-2"><strong>Gender:</strong> {{ patient.gender }}</div>
                        <div class="col-6 mb-2"><strong>Age:</strong> {{ patient.age }} yrs</div>
                        <div class="col-6 mb-2"><strong>Weight:</strong> {{ patient.weight }} kg</div>
                    </div>
                </div>
            </div>

            <hr>

            <div class="row mt-4">
                <div class="col-12">
                    <h6 class="fw-bold text-primary">MEDICAL HISTORY & NOTES</h6>
                    <div class="p-3 bg-light rounded border" style="min-height: 100px;">
                        {{ patient.medical_history or 'No history recorded.' }}
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-6">
                    <h6 class="fw-bold text-primary">ALLERGIES</h6>
                    <p class="{% if patient.allergies == 'Yes' %}text-danger fw-bold{% endif %}">
                        {{ patient.allergies }}
                    </p>
                </div>
                <div class="col-6">
                    <h6 class="fw-bold text-primary">NEXT APPOINTMENT</h6>
                    <p class="text-dark">{{ patient.appt_date }}</p>
                </div>
            </div>

            <div class="mt-5 pt-5 text-center border-top">
                <p class="small text-muted italic">This is a computer-generated document. Authorized signature required for validity.</p>
                <div class="mt-4" style="border-top: 1px solid #eee; width: 200px; margin: 0 auto;">
                    <p class="small">Dr. {{ session['username'] }}</p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* CSS for professional printing */
@media print {
    body { background: white !important; }
    .navbar, .d-print-none, .btn { display: none !important; }
    .card { border: none !important; box-shadow: none !important; margin: 0 !important; width: 100% !important; max-width: 100% !important; }
    .container { width: 100% !important; max-width: 100% !important; margin: 0 !important; padding: 0 !important; }
    @page { margin: 2cm; }
}
</style>
{% endblock %}